{{- if .Values.include.horizontalpodautoscaler -}}
apiVersion: autoscaling/v1
kind: HorizontalPodAutoscaler
metadata:
  name: {{ .Values.name }}
  labels:
    {{- range $key, $value := .Values.labels}}
    {{$key}}: {{$value}}
    {{- end}}
  {{- if .UseHpaScaler }}
  annotations:
    estafette.io/hpa-scaler: "true"
    estafette.io/hpa-scaler-prometheus-query: "{{ .Values.hpascalerpromquery }}"
    estafette.io/hpa-scaler-requests-per-replica: "{{ .Values.hpascalerrequestsperreplica }}"
    estafette.io/hpa-scaler-delta: "{{ .Values.hpascalerdelta }}"
    estafette.io/hpa-scaler-scale-down-max-ratio: "{{ .Values.hpascalerscaledownmaxratio }}"
  {{- end }}
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: {{ .Values.namewithtrack }}
  minReplicas: {{ .Values.minreplicas }}
  maxReplicas: {{ .Values.maxreplicas }}
  targetCPUUtilizationPercentage: {{ .Values.targetcpupercentage }}
{{- end -}}